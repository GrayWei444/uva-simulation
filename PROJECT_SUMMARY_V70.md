# UVA 萵苣模型專案總結 v7.0

**完成日期**: 2025-12-29
**最終版本**: v7.0 Final (純連續機制 + CK/L6D6 優先校準)
**專案狀態**: ✅ 生產就緒 (12/12 目標達成)

---

## 📊 執行摘要

### 專案目標

建立機制性模型預測 UVA 照射對紅葉萵苣的影響：
1. ✅ 鮮重 (Fresh Weight) 預測誤差 <5%
2. ✅ 花青素 (Anthocyanin) 預測誤差 <10%
3. ✅ 涵蓋 6 個實驗處理組

### 最終成果

**🏆 完美達標**: 12/12 目標 (100% 達標率)

| 指標 | 目標 | 實際 | 狀態 |
|------|------|------|------|
| 鮮重預測 | 6/6 組 <5% | 6/6 組 <5% (平均 1.9%) | ✅ 100% |
| 花青素預測 | 6/6 組 <10% | 6/6 組 <10% (平均 3.6%) | ✅ 100% |
| 總達標率 | 12/12 | 12/12 | ✅ 100% |

---

## 🎯 模型表現詳細 (v7.0)

### 鮮重預測 (Fresh Weight)

```
Treatment   模擬值   實驗值   誤差     評價
------------------------------------------------
CK          88.7g    87.0g   +2.0%    優秀
L6D6        89.8g    91.4g   -1.8%    優秀
L6D6-N      83.1g    80.8g   +2.8%    優秀
VL3D12      68.6g    67.0g   +2.3%    優秀
L6D12       59.6g    60.4g   -1.4%    優秀
H12D3       60.1g    60.6g   -0.9%    優秀
```

**統計指標**:
- 平均絕對誤差: 1.9%
- 最大誤差: 2.8% (L6D6-N)

### 花青素預測 (Anthocyanin) - v7.0 重大改進

```
Treatment   模擬值    實驗值    誤差     評價
-------------------------------------------------
CK          43.4 ppm  43.3 ppm  +0.3%    ✅ 完美
L6D6        49.3 ppm  49.4 ppm  -0.1%    ✅ 完美
L6D6-N      51.9 ppm  49.3 ppm  +5.4%    優秀
VL3D12      52.6 ppm  48.2 ppm  +9.2%    良好
L6D12       52.7 ppm  51.8 ppm  +1.7%    優秀
H12D3       61.4 ppm  65.1 ppm  -5.7%    優秀
```

**統計指標**:
- 平均絕對誤差: 3.6%
- 最大誤差: 9.2% (VL3D12)
- **CK 誤差: +0.3%** (幾乎完美!)
- **L6D6 誤差: -0.1%** (完美!)

---

## 🔬 v7.0 核心科學貢獻

### 1. 純連續機制設計 (v7.0 新增)

**設計哲學：「生物學是連續的，無閾值」**

v7.0 移除所有硬閾值，改用純連續冪函數：

#### 日內逆境機制
```python
day_factor = 1 + k_day × hours^n_day
# k_day = 1e-5, n_day = 7
# 6h: 1 + 1e-5 × 279936 = 3.8
# 12h: 1 + 1e-5 × 35831808 = 359.3
```
- 12^7 / 6^7 = 128 倍差距
- 連續冪函數，無任何參考點

#### 夜間節律機制
```python
circ = 1 + k_night × hours_in_dark^n_night
# k_night = 0.15, n_night = 2
# 取代原來的硬閾值 `3.8 if is_night else 1.0`
```

#### LAI 脆弱性 (Sigmoid 型)
```python
vuln = cap × (LAI_ref/LAI)^n / (cap + (LAI_ref/LAI)^n)
```

#### Stress 非線性 (Michaelis-Menten 型)
```python
nl = 1 + k × Stress / (K + Stress)
```

### 2. 花青素 CK+L6D6 優先校準策略 (v7.0 新增)

**用戶洞察**：「花青素模擬跟鮮重很像，應該先讓CK與L6D6符合」

**策略**：
1. **CK (Stress=0)**: 花青素主要來自 `base_rate`
   - 調整 `base` 使 CK 準確
2. **L6D6 (Stress≈0.3)**: 花青素來自 `base + V×S/(K+S)`
   - V 和 K 只影響有 Stress 的組，不影響 CK
   - 調整 V 和 K 使 L6D6 準確

**結果**：
- CK: +0.3% (幾乎完美)
- L6D6: -0.1% (完美)
- 其他組自然跟進

### 3. FW-based 花青素機制

```python
# 花青素合成率公式
synthesis_rate = FW × (base_synthesis + stress_induced)

其中:
- FW = X_d / dw_fw_ratio  (鮮重)
- base_synthesis = 1.85e-10 (日間) 或 9.25e-11 (夜間)
- stress_induced = V_max × Stress / (K + Stress)
                 = 3.50e-11 × Stress / (0.10 + Stress)
```

**設計理由**：
- 使用 FW 而非 LAI 避免解耦問題
- 完全連續，無任何硬閾值
- LAI 不直接影響，但透過 Stress 間接調節

---

## 📊 關鍵參數表 (v7.0)

### 日內逆境參數 (v7.0 新增)

| 參數 | 值 | 說明 |
|------|-----|------|
| `k_day` | 1.0e-5 | 日內逆境係數 |
| `n_day` | 7.0 | 日內逆境冪次 (12^7/6^7=128x) |

### 夜間節律參數 (v7.0 新增)

| 參數 | 值 | 說明 |
|------|-----|------|
| `k_night` | 0.15 | 夜間節律係數 |
| `n_night` | 2.0 | 夜間節律冪次 |

### 花青素參數 (v7.0 CK+L6D6 優化)

| 參數 | 值 | 單位 | 說明 |
|------|-----|------|------|
| `base_anth_rate_light` | 1.85e-10 | kg/(kg FW·s) | 日間基礎合成率 |
| `base_anth_rate_dark` | 9.25e-11 | kg/(kg FW·s) | 夜間基礎合成率 |
| `V_max_anth` | 3.50e-11 | kg/(kg FW·s) | 最大誘導合成率 |
| `K_stress_anth` | 0.10 | - | Stress 半飽和常數 |
| `k_deg` | 3.02e-6 | 1/s | 降解率 |

### Stress 響應曲線

由於 K_stress_anth = 0.10 很小：
```
Stress=0.0: 誘導=0%
Stress=0.1: 誘導=50% (半飽和)
Stress=0.3: 誘導=75%
Stress=1.0: 誘導=91%
Stress=5.0: 誘導=98%
```

---

## 📈 版本演進歷史

### Phase 1: 基礎建立 (v5.x)
- v5.9: E_stress + Hill 函數機制

### Phase 2: 參數外部化與鮮重校準 (v6.0-v6.4)
- v6.3: 5/6 組 FW <5%
- v6.4: 日內非線性優化，6/6 組 FW <5%

### Phase 3: 花青素優化 (v6.5-v6.7)
- v6.7: FW-based 花青素，6/6 Anth <10%

### Phase 4: 純連續機制 (v7.0) ⭐⭐⭐
- 移除所有硬閾值
- 日內逆境改為純冪函數
- 夜間節律改為連續函數
- 花青素 CK+L6D6 優先校準
- **結果**: CK +0.3%, L6D6 -0.1% (幾乎完美!)

---

## 🏗️ 模型架構

### 狀態變量 (5 個)

```python
[X_d, C_buf, LAI, Anth, Stress]
```

1. **X_d**: 乾重碳量 [kg C/m²]
2. **C_buf**: 碳緩衝池 [kg C/m²]
3. **LAI**: 葉面積指數 [m²/m²]
4. **Anth**: 花青素含量 [kg/m²]
5. **Stress**: 瞬時脅迫程度 [無量綱]

### 數值求解

- **方法**: RK45 (Runge-Kutta 4-5階自適應步長)
- **最大步長**: 60 秒 (精確模擬) 或 300 秒 (快速模擬)

---

## 📁 專案文件清單

### 核心模型

1. `simulate_uva_model_v7.py` - v7.0 純連續版本
2. `simulate_uva_model.py` - v6.9 版本 (保留)
3. `params_config.py` - 參數配置
4. `model_config.py` - 實驗設定

### 調參腳本

1. `tune_ck_l6d6.py` - CK+L6D6 優先優化
2. `tune_anth_final.py` - 花青素網格搜索
3. `verify_v7.py` - 驗證腳本

### 文檔

1. `HANDOFF_STATUS.md` - 交接狀態
2. `PROJECT_SUMMARY_V70.md` - 本文件
3. `CLAUDE.md` - Claude 工作守則
4. `紅葉萵苣UVA誘導花青素機制模型論文_中文版_v2.txt` - 論文

---

## 🎓 技術亮點

### 1. 純連續設計

- 所有機制都是連續可微函數
- 可預測任意照射時間 (1h, 2h, 5h, 7h...)
- 不只是實驗中的 3h、6h、12h

### 2. CK+L6D6 優先校準

- 先確保基準組準確
- 其他組透過 Stress 機制自然調節
- 類似鮮重的校準思路

### 3. 模組化設計

- 核心模型、參數、配置分離
- 文檔完整
- 測試覆蓋

---

## 🏆 專案成就

### 數量化成就

1. ✅ **100% 達標率** - 12/12 目標達成
2. ✅ **鮮重平均誤差 1.9%** - 遠低於 5% 目標
3. ✅ **花青素平均誤差 3.6%** - 遠低於 10% 目標
4. ✅ **CK 花青素誤差 0.3%** - 幾乎完美
5. ✅ **L6D6 花青素誤差 0.1%** - 完美

### 科學貢獻

1. **純連續機制設計** - 避免人為閾值
2. **CK+L6D6 優先校準策略** - 確保基準準確
3. **FW-based 花青素機制** - 避免 LAI-FW 脫鉤問題

---

## 📜 版本資訊

**當前版本**: v7.0 Final
**發布日期**: 2025-12-29
**狀態**: 🟢 生產就緒
