# 萵苣UVA模型 - 專案總結與規劃 (第二階段)

## 【第二階段: 核心技術、演化歷程與最終程式碼】

**接續**: 第一階段(專案全貌與新藍圖)
**更新日期**: 2026年1月2日
**最終版本**: v8.1 (ROS 動態模型優化版)
**當前狀態**: ✅ FW + Anth 全達標 12/12 (平均誤差 FW 2.2%, Anth 3.4%)

---

## 📖 第二階段目錄

### 第二部分: 模型演化與核心理论
6. [建模策略：由簡入繁的迭代之路](#6-建模策略由簡入繁的迭代之路)
7. [v4.x - v5.x - 基礎模型探索](#7-v4x---v5x---基礎模型探索)
8. [v6.x - v7.x - 核心突破：純連續機制](#8-v6x---v7x---核心突破純連續機制)

### 第三部分: 最终Python實現
9. [v7.2 核心機制總覽](#9-v72-核心機制總覽)
10. [最終模型驗證結果](#10-最終模型驗證結果)
11. [關鍵參數與公式](#11-關鍵參數與公式)

---

# 第二部分: 模型演化與核心理论

## 6. 建模策略：由簡入繁的迭代之路

我們並非一步到位地構建出最終模型，而是經歷了從簡單到複雜、不斷試錯的科學探索過程。

**核心原則（CLAUDE.md 規定）**：
- **禁止硬閾值**：所有機制必須是連續可微函數
- **數據驅動擬合**：參數由優化器自動確定，不是人為預設
- **延續性優先**：繼承已確認的設定，避免重複工作

---

## 7. v4.x - v5.x - 基礎模型探索

### v5.x 系列：引入動態 Stress
- 引入 `Stress` 狀態變量量化 UVA 逆境
- 問題：**蹺蹺板效應** - 無法同時校準高/低劑量組

### v6.x 系列：連續機制嘗試
- 引入 LAI 脆弱性、日內逆境累積
- 問題：硬閾值導致不連續，部分機制設計不符生物學

---

## 8. v6.x - v7.x - v8.0 核心突破：純連續機制

### v7.1：數據驅動參數擬合
- 讓 k_day 和 n_day 由優化器自動從數據擬合
- n_day ≈ 6.6 是數據要求的結果

### v7.2：機制修正版
- **修復飽和因子**：移到修復項
- **夜間節律損傷**：改為加項
- **花青素保護/消耗**：新增機制
- **UVA-PAR 光合貢獻**：增強讓 L6 組上升

### v8.0：ROS 動態模型版（當前版本）
- **移除舊機制**：nonlinear_factor, irradiation_amplifier, days_amplifier
- **新增 ROS 狀態變量**：用 ODE 描述 ROS 動態
- **ROS 動態公式**：`dROS/dt = k_prod × I_UVA × amp - k_clear × ROS`
- **ROS 非線性放大**：`amp = 1 + k × hours^n`（針對 H12D3）
- **簡化 LAI 脆弱性**：純反指數形式，無硬閾值

---

# 第三部分: 最终Python實現

## 9. v8.0 核心機制總覽

### 9.1 ROS 動態模型（v8.0 核心改進）

```python
# ROS 狀態變量，使用 ODE 描述動態
# dROS/dt = k_prod × I_UVA × amplification - k_clear × ROS

# ROS 生產（含非線性放大）
ros_amplification = 1.0 + k_ros_amplification * (hours_today ** n_ros_amplification)
ros_production = k_ros_production * I_UVA * ros_amplification

# ROS 清除（一階動力學）
ros_clearance = k_ros_clearance * ROS

dROS_dt = ros_production - ros_clearance

# 參數值：
# k_ros_production = 0.00095
# k_ros_clearance = 5e-4
# k_ros_amplification = 5e-7
# n_ros_amplification = 8.0
```

**生物學意義**：
- UVA 照射產生 ROS，細胞同時清除 ROS
- 長時間照射時，光敏化產物累積導致 ROS 產生加速（非線性放大）
- 設計使 6h 放大 ≈ 1.84，12h 放大 ≈ 216

### 9.2 LAI 脆弱性（純反指數形式）

```python
# 公式: vuln = A × exp(-k × LAI) + 1
A_vulnerability = 1170.0  # 振幅（v8.1 更新）
k_vulnerability = 0.82    # 衰減係數（v8.1 更新）

vulnerability = A_vulnerability * np.exp(-k_vulnerability * LAI) + 1.0

# 數值範例：
# LAI=5: vuln ≈ 19.4 (幼苗更脆弱)
# LAI=7: vuln ≈ 4.0 (中期)
# LAI=9: vuln ≈ 1.7 (成熟植株較能抵抗)
```

**生物學意義**：幼嫩植物防禦機制未成熟，對 UVA 更敏感。

### 9.3 損傷公式（v8.0 簡化版）

```python
# damage = k_damage × ROS × vulnerability × (1 - anth_protection)
base_damage = stress_damage_coeff * ROS * vulnerability
protected_damage = base_damage * (1.0 - anth_protection)

# 參數值：
# stress_damage_coeff = 3.0e-7
```

**v8.0 改進**：移除舊的 nonlinear_factor、irradiation_amplifier、days_amplifier

### 9.4 UVA-PAR 光合貢獻

```python
'par_conversion_factor': 3.25  # UVA 轉 PAR 係數（v8.1 更新）

I_effective = I_base + I_UVA * par_conversion_factor
```

**生物學意義**：UVA 對光合作用有顯著貢獻，使 L6D6 組 FW 上升。v8.1 增加此參數值（從 1.6 到 3.25）以更準確模擬 L6D6 的 FW 增加（誤差從 -4.6% 改進到 -1.4%）。

### 9.5 花青素合成與保護

```python
# UVA 累積誘導合成
uva_induced = V_max_anth * total_uva_hours / (K_stress_anth + total_uva_hours)

# 保護效應：花青素減少 ROS 損傷
anth_protection = alpha_anth_protection × Anth / (K_anth_protection + Anth)

# 參數值（v8.1 更新）：
# V_max_anth = 7.0e-11
# K_stress_anth = 35.0
# k_anth_consumption = 5e-4
```

---

## 10. 最終模型驗證結果

### v8.1 全達標！(12/12)

| 處理組 | 觀測FW | 模擬FW | FW誤差 | 觀測Anth | 模擬Anth | Anth誤差 | Stress |
|--------|--------|--------|--------|----------|----------|----------|--------|
| CK | 87.0 | 88.7 | +2.0%✓ | 43.3 | 41.8 | -3.6%✓ | 0.0 |
| L6D6 | 91.4 | 90.1 | -1.4%✓ | 49.4 | 50.3 | +1.9%✓ | 1.4 |
| L6D6-N | 80.8 | 83.5 | +3.3%✓ | 49.3 | 51.7 | +5.0%✓ | 4.0 |
| VL3D12 | 67.0 | 66.9 | -0.2%✓ | 48.2 | 45.8 | -4.9%✓ | 5.4 |
| L6D12 | 60.4 | 61.4 | +1.6%✓ | 51.8 | 50.1 | -3.2%✓ | 12.4 |
| H12D3 | 60.6 | 63.4 | +4.6%✓ | 65.1 | 66.3 | +1.8%✓ | 34.5 |

**統計**：FW 6/6 (100%), Anth 6/6 (100%), Total 12/12

**v8.1 關鍵成果**：
- **FW + Anth 全達標 (12/12)**：所有處理組誤差均在 ±5% 內
- **L6D6 誤差接近 0%**：從 v8.0 的 -4.6% 改進到 -1.4%
- **VL3D12 誤差接近 0%**：從 v8.0 的 +4.8% 改進到 -0.2%
- **平均誤差大幅改善**：FW 平均 2.2%，Anth 平均 3.4%
- **ROS 動態模型**：用有生物學意義的 ODE 取代硬編碼公式
- 純連續機制，無任何硬閾值

### v8.1 vs v8.0 比較

| 改進項目 | v8.0 | v8.1 |
|---------|------|------|
| L6D6 FW 誤差 | -4.6% | -1.4% |
| VL3D12 FW 誤差 | +4.8% | -0.2% |
| par_conversion_factor | 1.6 | 3.25 |
| A_vulnerability | 550 | 1170 |
| V_max_anth | 7.5e-11 | 7.0e-11 |
| k_circadian | 0.7e-7 | 1.0e-7 |
| FW 平均誤差 | 3.2% | 2.2% |

---

## 11. 關鍵參數與公式

### 11.1 ROS 動態參數（v8.0 新增）

| 參數 | 值 | 說明 |
|------|-----|------|
| k_ros_production | 0.00095 | ROS 生產係數 |
| k_ros_clearance | 5e-4 | ROS 清除係數 |
| k_ros_amplification | 5e-7 | ROS 放大係數（針對 H12D3） |
| n_ros_amplification | 8.0 | ROS 放大冪次 |

### 11.2 損傷與脆弱性參數（v8.1 更新）

| 參數 | 值 | 說明 |
|------|-----|------|
| stress_damage_coeff | 3.0×10⁻⁷ | 基礎損傷係數 |
| A_vulnerability | **1170.0** | LAI 脆弱性振幅（v8.1 增加） |
| k_vulnerability | **0.82** | LAI 脆弱性衰減（v8.1 更新） |
| par_conversion_factor | **3.25** | UVA-PAR 轉換（v8.1 增加） |
| k_circadian | **1.0e-7** | 夜間節律損傷（v8.1 更新） |

### 11.3 花青素參數（v8.1 更新）

| 參數 | 值 | 說明 |
|------|-----|------|
| V_max_anth | **7.0e-11** | UVA 誘導最大合成率（v8.1 降低） |
| K_stress_anth | 35.0 | UVA 累積半飽和常數 |
| k_anth_consumption | 5e-4 | 花青素消耗係數 |

### 11.4 校準邏輯（用戶明確指示）

**校準順序（必須遵守）**：

| 順序 | 處理組 | 主要調整機制 | 目標 |
|------|--------|-------------|------|
| 1 | **L6D6** | 基準組 | Stress ≈ 0，幾乎無損傷 |
| 2 | **L6D6-N** | 夜間節律損傷 | 比 L6D6 損傷大 |
| 3 | **VL3D12** | LAI 脆弱性 | 早期照射損傷 |
| 4 | **L6D12** | LAI 脆弱性 | 早期照射損傷 |
| 5 | **H12D3** | ROS 非線性放大 | 長時間照射損傷 |

**關鍵原則**：
- L6D6 是基準，6h/day 日間照射應該 **幾乎無損傷**
- ROS 非線性放大 **只針對 H12D3**（12h/day）
- D12 組損傷 **靠 LAI 脆弱性**，不是 ROS 放大
- 先讓 L6D6 達標，再依序調整其他組

---

## 12. 檔案結構

| 檔案 | 說明 |
|------|------|
| `simulate_uva_model_v8.py` | ✅ v8.0 主模型（12/12 全達標） |
| `simulate_uva_model_v72.py` | v7.x 舊版（備份） |
| `model_config.py` | 處理組配置與實驗數據 |
| `CLAUDE.md` | 工作守則（v2.0 含校準策略） |
| `HANDOFF_STATUS.md` | 交接狀態 |
| `MODEL_DESIGN_NOTES.md` | 模型設計筆記 |

---

## 13. 專案完成狀態

✅ **v8.0 校準完成 - 12/12 全達標！**

- FW 6/6 達標（平均誤差 3.2%）
- Anth 6/6 達標（平均誤差 3.3%）
- ROS 動態模型取代舊的硬編碼公式
- 純連續機制，符合生物學原理
