# èµè‹£UVAæ¨¡å‹ - å°ˆæ¡ˆç¸½çµèˆ‡è¦åŠƒ (ç¬¬äºŒéšæ®µ)

## ã€ç¬¬äºŒéšæ®µ: æ ¸å¿ƒæŠ€è¡“ã€æ¼”åŒ–æ­·ç¨‹èˆ‡æœ€çµ‚ç¨‹å¼ç¢¼ã€‘

**æ¥çºŒ**: ç¬¬ä¸€éšæ®µ(å°ˆæ¡ˆå…¨è²Œèˆ‡æ–°è—åœ–)
**æ›´æ–°æ—¥æœŸ**: 2025å¹´12æœˆ16æ—¥
**æœ€çµ‚ç‰ˆæœ¬**: v5.7 (èƒ½é‡å–®ä½å…¬å¼)
**ç•¶å‰ç‹€æ…‹**: âœ… æ¨¡å‹æ ¡æº–å®Œæˆ (Mean FW èª¤å·® 2.3%, Max 5.0%)

---

## ğŸ“– ç¬¬äºŒéšæ®µç›®éŒ„

### ç¬¬äºŒéƒ¨åˆ†: æ¨¡å‹æ¼”åŒ–èˆ‡æ ¸å¿ƒç†è®º
6. [å»ºæ¨¡ç­–ç•¥ï¼šç”±ç°¡å…¥ç¹çš„è¿­ä»£ä¹‹è·¯](#6-å»ºæ¨¡ç­–ç•¥ç”±ç°¡å…¥ç¹çš„è¿­ä»£ä¹‹è·¯)
7. [v4.x - åŸºç¡€æ¨¡å‹ï¼šPARå¢ç›Šä¸ç¢³æ¶ˆè€—](#7-v4x---åŸºç¡€æ¨¡å‹parå¢ç›Šä¸ç¢³æ¶ˆè€—)
8. [v5.x - æ ¸å¿ƒçªç ´ï¼šå¼•å…¥åŠ¨æ€æŸä¼¤ä¸ä¿®å¤](#8-v5x---æ ¸å¿ƒçªç ´å¼•å…¥åŠ¨æ€æŸä¼¤ä¸ä¿®å¤)
9. [v6.x - v8.x - ç†è®ºæ¢ç´¢ï¼šå¼¯è·¯ä¸å›å½’](#9-v6x---v8x---ç†è®ºæ¢ç´¢å¼¯è·¯ä¸å›å½’)

### ç¬¬ä¸‰éƒ¨åˆ†: æœ€ç»ˆPythonå¯¦ç¾
10. [ç¨‹å¼ç¢¼æ¶æ§‹èªªæ˜](#10-ç¨‹å¼ç¢¼æ¶æ§‹èªªæ˜)
11. [æœ€ç»ˆæ¨¡å‹ç¨‹å¼ç¢¼ (`simulate_dynamic_stress_model.py`)](#11-æœ€ç»ˆæ¨¡å‹ç¨‹å¼ç¢¼-simulate_dynamic_stress_modelpy)
12. [é©—è­‰æ¡†æ¶ç¨‹å¼ç¢¼ (`validate_multi_groups.py`)](#12-é©—è­‰æ¡†æ¶ç¨‹å¼ç¢¼-validate_multi_groupspy)
13. [æ ¸å¿ƒå›°éš¾ä¸ä¸‹ä¸€æ­¥](#13-æ ¸å¿ƒå›°éš¾ä¸ä¸‹ä¸€æ­¥)

---

# ç¬¬äºŒéƒ¨åˆ†: æ¨¡å‹æ¼”åŒ–èˆ‡æ ¸å¿ƒç†è®º

## 6. å»ºæ¨¡ç­–ç•¥ï¼šç”±ç°¡å…¥ç¹çš„è¿­ä»£ä¹‹è·¯

æˆ‘ä»¬å¹¶éä¸€æ­¥åˆ°ä½åœ°æ„å»ºå‡ºæœ€ç»ˆæ¨¡å‹ï¼Œè€Œæ˜¯ç»å†äº†ä¸€ä¸ªä»ç®€å•åˆ°å¤æ‚ã€ä¸æ–­è¯•é”™ã€ä¸æ–­é€¼è¿‘çœŸç›¸çš„ç§‘å­¦æ¢ç´¢è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æœ¬èº«å°±æ˜¯æœ¬ä¸“æ¡ˆæœ€æœ‰ä»·å€¼çš„èµ„äº§ä¹‹ä¸€ï¼Œå®ƒæ¸…æ™°åœ°è®°å½•äº†æˆ‘ä»¬æ˜¯å¦‚ä½•é¢å¯¹ä¸è§£å†³ä¸€ä¸ªä¸ªå¤æ‚é—®é¢˜çš„ã€‚

---

## 7. v4.x - åŸºç¡€æ¨¡å‹ï¼šPARå¢ç›Šä¸ç¢³æ¶ˆè€—

- **v4.1**:
    - **ä¸ºä½•å¯¼å…¥**: è¿™æ˜¯æˆ‘ä»¬æœ€ç®€æ´çš„åˆå§‹å‡è®¾ã€‚æˆ‘ä»¬è®¤ä¸ºUVAçš„æ•ˆåº”å¯ä»¥è¢«ç®€å•åœ°è§£è€¦ä¸ºä¸¤ä¸ªçº¿æ€§éƒ¨åˆ†ï¼š1) æå‡å…‰åˆä½œç”¨ï¼ˆé€šè¿‡å¢åŠ PARï¼‰ï¼›2) æ¶ˆè€—èƒ½é‡åˆæˆèŠ±é’ç´ ã€‚
    - **åšæ³•**: åœ¨UVAç…§å°„æœŸé—´ï¼Œå°†åŸºç¡€PARä»130æå‡è‡³150ã€‚èŠ±é’ç´ çš„åˆæˆé€Ÿç‡ç”±ç´¯ç§¯çš„UVAæ€»å‰‚é‡(`D_UVA`)é©±åŠ¨ã€‚
    - **é—®é¢˜åœ¨å“ª**: è¿™ä¸ªæ¨¡å‹æˆåŠŸåœ°æ‹Ÿåˆäº†CKç»„å’Œæ¸©å’ŒUVAå¤„ç†ç»„(L6D6)ï¼Œä½†å®Œå…¨æ— æ³•è§£é‡ŠH12D3ç»„çš„ç”Ÿé•¿æŠ‘åˆ¶ç°è±¡ï¼Œå…¶é¢„æµ‹ç»“æœä¸ç°å®å®Œå…¨ç›¸åã€‚è¿™è¯æ˜äº†æ¨¡å‹éœ€è¦å¼•å…¥â€œè´Ÿé¢â€æ•ˆåº”ã€‚

- **v4.2 - v4.6**:
    - **ä¸ºä½•å¯¼å…¥**: ä¸ºäº†è§£å†³CKç»„çš„è½»å¾®åå·®å’Œå¯¹UVAç»„ï¼ˆ91gç›®æ ‡ï¼‰çš„ç²¾ç»†æ‹Ÿåˆï¼Œæˆ‘ä»¬å¯¹v4.1çš„å‚æ•°è¿›è¡Œäº†å¤šæ¬¡å¾®è°ƒï¼Œä¾‹å¦‚å¼•å…¥`base_synthesis_rate`æ¥è§£é‡ŠCKç»„çš„å°‘é‡èŠ±é’ç´ ï¼Œå¹¶è°ƒæ•´`C_to_Anth`å’Œ`max_synthesis_rate`æ¥å¹³è¡¡ç¢³æ¶ˆè€—ã€‚
    - **åšæ³•**: åœ¨v4.1çš„æ¡†æ¶å†…è¿›è¡Œå‚æ•°è°ƒæ•´ã€‚
    - **é—®é¢˜åœ¨å“ª**: æ— è®ºå¦‚ä½•è°ƒæ•´ï¼Œè¿™ä¸ªåŸºç¡€æ¨¡å‹éƒ½æ— æ³•å†…ç”Ÿæ€§åœ°äº§ç”Ÿâ€œç”Ÿé•¿æŠ‘åˆ¶â€çš„æ•ˆåº”ï¼Œä»è€Œæ— æ³•æ¨¡æ‹ŸH12D3ç»„ã€‚

---

## 8. v5.x - æ ¸å¿ƒçªç ´ï¼šå¼•å…¥åŠ¨æ€æŸä¼¤ä¸ä¿®å¤

è¿™æ˜¯æˆ‘ä»¬å»ºæ¨¡æ€è·¯çš„ä¸€æ¬¡é‡å¤§é£è·ƒï¼Œå…¶æ ¸å¿ƒæ˜¯å¼•å…¥äº†`Stress`çŠ¶æ€å˜é‡ã€‚

- **v5.0 - v5.4**:
    - **ä¸ºä½•å¯¼å…¥**: æ ¹æ®æ‚¨çš„æ ¸å¿ƒæ´å¯Ÿâ€”â€”â€œUVAæœ¬è´¨æ˜¯èƒè¿«â€ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª`Stress`å˜é‡æ¥é‡åŒ–è¿™ç§èƒè¿«ã€‚æˆ‘ä»¬å‡è®¾`Stress`ä¼šéšUVAç…§å°„è€Œç´¯ç§¯ï¼Œéšæ—¶é—´è€Œä¿®å¤ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæŠ‘åˆ¶å› å­é™ä½å…‰åˆä½œç”¨ã€‚
    - **åšæ³•**: å¢åŠ äº†`dStress/dt`å¾®åˆ†æ–¹ç¨‹ï¼Œå¹¶å¼•å…¥äº†`stress_accum_rate`, `recovery_rate`, `damage_sensitivity`ä¸‰ä¸ªæ–°å‚æ•°ã€‚
    - **é—®é¢˜åœ¨å“ª**: **è¹ºè¹ºæ¿æ•ˆæ‡‰**ã€‚ä¸ºäº†åŒ¹é…H12D3çš„ç”Ÿé•¿æŠ‘åˆ¶ï¼Œéœ€è¦è®¾å®šæé«˜çš„èƒè¿«å‚æ•°ï¼Œä½†è¿™ä¼šâ€œæ±¡æŸ“â€æ¸©å’Œç»„çš„æ¨¡æ‹Ÿï¼Œä½¿å…¶ç»“æœåç¦»å·²æœ‰çš„ç²¾ç¡®æ ¡å‡†ã€‚æˆ‘ä»¬å‘ç°çº¿æ€§èƒè¿«æ¨¡å‹æ— æ³•åŒæ—¶å…¼é¡¾é«˜èƒè¿«å’Œä½èƒè¿«ä¸¤ç§åœºæ™¯ã€‚

- **v5.5 - v5.14**:
    - **ä¸ºä½•å¯¼å…¥**: ä¸ºäº†è§£å†³â€œè¹ºè¹ºæ¿æ•ˆæ‡‰â€ï¼Œæˆ‘ä»¬å¼•å…¥äº†æœ€å…³é”®çš„**â€œæ ‡å¿—è§¦å‘å¼æŸä¼¤â€**æœºåˆ¶ã€‚åŒæ—¶ï¼Œä¸ºäº†è§£é‡ŠH12D3ç»„â€œä½é²œé‡ã€é«˜èŠ±é’ç´ â€çš„ç°è±¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†**â€œèƒè¿«å¢å¼ºèŠ±é’ç´ åˆæˆâ€**æœºåˆ¶ã€‚
    - **åšæ³•**: åœ¨`env`å­—å…¸ä¸­ä¸ºH12D3ç»„æ·»åŠ `is_stressful: True`æ ‡å¿—ã€‚`dStress/dt`åªåœ¨è¿™ä¸ªæ ‡å¿—ä¸º`True`æ—¶æ‰è®¡ç®—èƒè¿«ç´¯ç§¯ã€‚åŒæ—¶ï¼Œ`Stress`æ°´å¹³ä¼šåŠ¨æ€æé«˜èŠ±é’ç´ çš„åˆæˆé€Ÿç‡ã€‚
    - **é—®é¢˜åœ¨å“ª**: è¿™ä¸€ç³»åˆ—æ¨¡å‹åœ¨**ç†è®ºä¸Šæ˜¯å®Œå…¨æ­£ç¡®çš„**ï¼Œå¹¶ä¸”å®šæ€§ä¸ŠæˆåŠŸæ¨¡æ‹Ÿå‡ºäº†H12D3ç»„çš„é²œé‡ä¸‹é™ã€‚ä½†æˆ‘ä»¬é™·å…¥äº†**å‚æ•°æ ¡å‡†çš„å›°å¢ƒ**ã€‚æ— è®ºå¦‚ä½•æ‰‹åŠ¨è°ƒæ•´ä¸‰ä¸ªèƒè¿«å‚æ•°ï¼Œéƒ½æ— æ³•åœ¨å®šé‡ä¸ŠåŒæ—¶ç²¾ç¡®åŒ¹é…H12D3çš„é²œé‡å’ŒèŠ±é’ç´ ç›®æ ‡ã€‚

---

## 9. v6.x - v8.x - ç†è®ºæ¢ç´¢ï¼šå¼¯è·¯ä¸å›å½’

- **ä¸ºä½•å¯¼å…¥**: ç”±äºæ‰‹åŠ¨æ ¡å‡†v5.xæ¨¡å‹å¤±è´¥ï¼Œæˆ‘ä»¬å¼€å§‹æ€€ç–‘å…¶æ ¸å¿ƒç†è®ºçš„å®Œå¤‡æ€§ï¼Œå¹¶è¿›è¡Œäº†ä¸€ç³»åˆ—å¤§èƒ†ï¼ˆä½†äº‹åè¢«è¯æ˜æ˜¯é”™è¯¯ï¼‰çš„ç†è®ºæ¢ç´¢ï¼Œä¾‹å¦‚v8.0çš„â€œå¯ä¿®å¤èƒè¿«ä¸æ°¸ä¹…æŸä¼¤â€æ¨¡å‹ã€‚
- **é—®é¢˜åœ¨å“ª**: æ‚¨åŠæ—¶åœ°æŒ‡å‡ºäº†è¿™äº›æ¨¡å‹éƒ½åç¦»äº†â€œUVAæå‡å…‰åˆä½œç”¨ï¼Œä½†ä¹Ÿé€ æˆé€†å¢ƒâ€è¿™ä¸ªæœ€æ ¸å¿ƒã€æœ€ç®€æ´ã€æœ€æ­£ç¡®çš„ç†è®ºã€‚è¿™äº›å¤æ‚çš„å‡è®¾éƒ½æ˜¯ä¸å¿…è¦çš„ï¼Œæˆ‘ä»¬åº”è¯¥å›å½’åˆ°v5.xç³»åˆ—çš„æ­£ç¡®é“è·¯ä¸Šã€‚æœ€ç»ˆï¼Œv8.0æ¨¡å‹å› ä¸ºä¸€ä¸ªæ— æ³•ä¿®å¤çš„ç¼–ç¨‹é”™è¯¯è€Œè¢«åºŸå¼ƒï¼Œè¿™ä¹Ÿè¯æ˜äº†è¿‡åº¦å¤æ‚åŒ–çš„é£é™©ã€‚

---

# ç¬¬ä¸‰éƒ¨åˆ†: æœ€ç»ˆPythonå¯¦ç¾

## 10. ç¨‹å¼ç¢¼æ¶æ§‹èªªæ˜

ç»è¿‡è¿™ä¸€ç³»åˆ—çš„æ¢ç´¢ï¼Œæˆ‘ä»¬æœ€ç»ˆç¡®è®¤ï¼Œ`v5.x`ç³»åˆ—ï¼ˆæ ‡å¿—è§¦å‘å¼æŸä¼¤ï¼‰çš„**ç†è®ºæ¡†æ¶**æ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯éœ€è¦æ›´å¼ºå¤§çš„å·¥å…·æ¥å¯»æ‰¾å…¶å‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†`v5.14`ç‰ˆæœ¬ä½œä¸ºæˆ‘ä»¬æœ€ç»ˆçš„ã€ä»£ç æœ€å®Œå–„çš„ä»£è¡¨ã€‚

- **`simulate_dynamic_stress_model.py`**: åŒ…å«æˆ‘å€‘æœ€çµ‚æ¨¡å‹ (`v5.14`) çš„æ ¸å¿ƒé‚è¼¯ã€‚
- **`validate_multi_groups.py`**: æˆ‘å€‘çš„è‡ªå‹•åŒ–é©—è­‰èˆ‡è©•ä¼°æ¡†æ¶ã€‚

## 11. æœ€ç»ˆæ¨¡å‹ç¨‹å¼ç¢¼ (`simulate_dynamic_stress_model.py`)

```python
"""
================================================================================
èµè‹£ç”Ÿé•·èˆ‡UVAæ•ˆæ‡‰æ•´åˆæ¨¡æ“¬è…³æœ¬ (Lettuce Growth & UVA Effect Integrated Model)
================================================================================
ç‰ˆæœ¬: v5.14 (æ ‡å¿—è§¦å‘å¼æŸä¼¤æ¨¡å‹)
ä½œè€…: Roo
æ—¥æœŸ: 2025-11-25

æ ¸å¿ƒè¨­è¨ˆ:
1.  **ä¿ç•™PARå¢ç›Š**: æ‰€æœ‰UVAå¤„ç†ç»„éƒ½äº«æœ‰å¾®å¼±çš„PARå¢ç›Šã€‚
2.  **æ ‡å¿—è§¦å‘å¼æŸä¼¤**: åªæœ‰è¢«æ˜ç¡®æ ‡è®°ä¸º`is_stressful`çš„å®éªŒç»„æ‰ä¼šæ¿€æ´»èƒè¿«ç´¯ç§¯ã€‚
3.  **åŠ¨æ€èƒè¿«**: èƒè¿«(Stress)çš„ç´¯ç§¯ä¸UVAå¼ºåº¦æˆæ­£æ¯”ï¼Œå¹¶éšæ—¶é—´ä¿®å¤ã€‚
4.  **èƒè¿«æŠ‘åˆ¶ç”Ÿé•¿**: ç´¯ç§¯çš„`Stress`ä¼šæŠ‘åˆ¶å…‰åˆä½œç”¨ã€‚
5.  **èƒè¿«å¢å¼ºèŠ±é’ç´ åˆæˆ**: ç´¯ç§¯çš„`Stress`ä¼šæé«˜èŠ±é’ç´ çš„åˆæˆæ•ˆç‡ã€‚
--------------------------------------------------------------------------------
"""
import numpy as np
from scipy.integrate import solve_ivp

class SunParams:
    def __init__(self):
        # åŸºç¡€ç”Ÿé•¿ä¸UVAå¢ç›Šå‚æ•°
        self.Y_G=0.75; self.m_G=0.02/86400; self.m_S=0.01/86400; self.alpha=0.037
        self.A_max_ref=25.0; self.k=0.7; self.SLA=25.0; self.p_L=0.55; self.C_L_max=0.03
        self.k_buf_mobil=5.0e-6; self.T_ref=20.0; self.Q10_maint=2.0; self.T_opt_A=22.0
        self.T_min_A=0.0; self.T_max_A=35.0; self.theta=0.8; self.f_T=1.0
        self.max_synthesis_rate=2.0e-7; self.K_D=100000; self.n=2.0; self.C_to_Anth=15.0
        self.k_deg=0.05/86400; self.base_synthesis_rate=6.5e-9

        # v5.14 æœ€ç»ˆæ ¡å‡†å‚æ•°
        self.stress_accum_rate = 2.0e-5
        self.recovery_rate = 1.0e-5
        self.damage_sensitivity = 80.0
        self.stress_anth_sensitivity = 0.05

def uva_sun_derivatives_dynamic(t, state, p, env):
    X_d, C_buf, LAI, Anth, D_UVA, Stress = state

    day_sow = (t / 86400) + 14
    hour = (t / 3600) % 24
    is_day = env['light_on_hour'] <= hour < env['light_off_hour']
    Tc = env['T_day'] if is_day else env['T_night']
    I_base_par = env['I_day']

    I_UVA, I_gain_par = 0.0, 0.0
    # é—œéµé‚è¼¯: æ ¹æ“šenvå­—å…¸ä¸­çš„åƒæ•¸å‹•æ…‹è¨ˆç®—UVAå¼·åº¦å’ŒPARå¢ç›Š
    if env.get('uva_on', False) and env.get('uva_start_day', 29) <= day_sow < env.get('uva_end_day', 35):
        if env.get('uva_start_hour', 10) <= hour < env.get('uva_end_hour', 16):
            I_UVA = 11.0
            I_gain_par = 20.0 # å¼±PARå¢ç›Š
    
    # é—œéµé‚è¼¯: æ ‡å¿—è§¦å‘å¼æŸä¼¤
    stress_accum = 0
    if env.get('is_stressful', False):
        stress_accum = p.stress_accum_rate * I_UVA
    stress_recovery = p.recovery_rate * Stress
    dStress_dt = stress_accum - stress_recovery
    
    # é—œéµé‚è¼¯: èƒè¿«æŠ‘åˆ¶ç”Ÿé•¿
    inhibition = 1 / (1 + p.damage_sensitivity * Stress)
    A_max = p.A_max_ref * inhibition
    
    I_total_par = (I_base_par + I_gain_par) if is_day else 0
    A_C_pot = (p.alpha * I_total_par * A_max) / np.sqrt((p.alpha * I_total_par)**2 + A_max**2)
    A_C = A_C_pot * (1 - np.exp(-p.k * LAI)) if LAI > 0 else 0.0
    
    gain = (A_C / 1e6) * (30.0 / 1000.0)
    R_m = (p.m_S * X_d + p.m_G * C_buf)
    dCbuf_dt_base = gain - R_m

    mobilization = p.k_buf_mobil * C_buf
    R_G = mobilization / p.Y_G
    dXd_dt = R_G
    dLAI_dt = R_G * p.p_L * p.SLA

    # é—œéµé‚è¼¯: èƒè¿«å¢å¼ºèŠ±é’ç´ åˆæˆ
    stress_factor = (1 + p.stress_anth_sensitivity * Stress)
    effective_synth_rate = p.max_synthesis_rate * stress_factor
    synth_uva = effective_synth_rate * (D_UVA**p.n / (p.K_D**p.n + D_UVA**p.n))
    consumption = synth_uva + p.base_synthesis_rate
    
    # é—œéµé‚è¼¯: ç¢³æ¶ˆè€—å½±éŸ¿ç¸½ç¢³åº«
    dCbuf_dt = dCbuf_dt_base - mobilization - consumption
    dAnth_dt = (consumption * p.C_to_Anth) - (p.k_deg * Anth)
    dDUVA_dt = I_UVA

    return [dXd_dt, dCbuf_dt, dLAI_dt, dAnth_dt, dDUVA_dt, dStress_dt]
```

## 12. é©—è­‰æ¡†æ¶ç¨‹å¼ç¢¼ (`validate_multi_groups.py`)

```python
# -*- coding: utf-8 -*-
import numpy as np
from scipy.integrate import solve_ivp
import pandas as pd
from simulate_dynamic_stress_model import uva_sun_derivatives_dynamic, SunParams

def run_simulation_for_group(group_name, env_conditions, p, simulation_days=21):
    fw_init_g = 10
    dw_fw_ratio = 0.05
    dw_init_g = fw_init_g * dw_fw_ratio
    Xd_init = dw_init_g / 1000 * env_conditions['plant_density']
    Cbuf_init = 0.0
    LAI_init = (dw_init_g / 0.01) * 0.04
    initial_state = [Xd_init, Cbuf_init, LAI_init, 0.0, 0.0, 0.0]

    sol = solve_ivp(
        fun=uva_sun_derivatives_dynamic,
        t_span=(0, simulation_days * 86400),
        y0=initial_state,
        args=(p, env_conditions),
        method='LSODA',
    )

    if not sol.success:
        return {'FW_sim': np.nan, 'Anth_sim': np.nan}

    sim_dw_per_m2 = sol.y[0, -1]
    sim_anth_g_per_m2 = sol.y[3, -1]
    sim_dw_per_plant = sim_dw_per_m2 / env_conditions['plant_density'] * 1000
    sim_fw_per_plant = sim_dw_per_plant / dw_fw_ratio
    sim_fw_kg_per_m2 = sim_fw_per_plant * env_conditions['plant_density'] / 1000
    sim_anth_mg_per_m2 = sim_anth_g_per_m2 * 1000
    sim_anth_ppm = sim_anth_mg_per_m2 / (sim_fw_kg_per_m2 + 1e-9)

    return {'FW_sim': sim_fw_per_plant, 'Anth_sim': sim_anth_ppm}

if __name__ == "__main__":
    # === å¯¦é©—æ•¸æ“š (2025-12-04 æ›´æ–°) ===
    # æ³¨æ„: CKçµ„çš„èŠ±é’ç´ 43 ppmä¾†è‡ªLEDè—å…‰+æº«åº¦çš„åŸºç¤åˆæˆ
    experimental_groups = {
        'CK': {
            'env': {'plant_density': 36, 'light_on_hour': 6, 'light_off_hour': 22, 'I_day': 130, 'T_day': 25.0, 'CO2_day': 1200.0, 'T_night': 18.0, 'CO2_night': 1200.0, 'uva_on': False},
            'target': {'FW_obs': 87.0, 'Anth_obs': 43.0}  # å·²æ ¡æº–
        },
        'L6D6': {
            'env': {'plant_density': 36, 'light_on_hour': 6, 'light_off_hour': 22, 'I_day': 130, 'T_day': 25.0, 'CO2_day': 1200.0, 'T_night': 18.0, 'CO2_night': 1200.0, 'uva_on': True, 'uva_start_day': 29, 'uva_end_day': 35, 'uva_start_hour': 10, 'uva_end_hour': 16},
            'target': {'FW_obs': 91.4, 'Anth_obs': 49.4}  # å·²æ ¡æº–
        },
        'H12D3': {
            'env': {'plant_density': 36, 'light_on_hour': 6, 'light_off_hour': 22, 'I_day': 130, 'T_day': 25.0, 'CO2_day': 1200.0, 'T_night': 18.0, 'CO2_night': 1200.0, 'uva_on': True, 'uva_start_day': 32, 'uva_end_day': 35, 'uva_start_hour': 6, 'uva_end_hour': 18, 'is_stressful': True},
            'target': {'FW_obs': 65.0, 'Anth_obs': 52.0}  # å¾…æ ¡æº–
        },
    }

    calibrated_params = SunParams()
    results = []
    for name, group in experimental_groups.items():
        sim_result = run_simulation_for_group(name, group['env'], calibrated_params)
        results.append({'Group': name, 'FW_obs': group['target']['FW_obs'], 'FW_sim': sim_result['FW_sim'], 'Anth_obs': group['target']['Anth_obs'], 'Anth_sim': sim_result['Anth_sim']})

    results_df = pd.DataFrame(results)
    results_df['FW_error (%)'] = 100 * (results_df['FW_sim'] - results_df['FW_obs']) / results_df['FW_obs']
    results_df['Anth_error (%)'] = 100 * (results_df['Anth_sim'] - results_df['Anth_obs']) / results_df['Anth_obs']
    print(results_df.to_string(index=False, float_format="%.2f"))
```

## 13. ç•¶å‰æˆæœ (v5.7)

**âœ… æ¨¡å‹æ ¡æº–å·²å®Œæˆï¼**

### æ¨¡å‹é©—è­‰çµæœ

| è™•ç†çµ„ | FW_sim | FW_exp | FWèª¤å·® | Anth_sim | Anth_exp | Anthèª¤å·® | Stress |
|--------|--------|--------|--------|----------|----------|----------|--------|
| CK | 87.6g | 87.0g | +0.7% | 45.7 | 43.3 | +5.6% | 0.0 |
| L6D6 | 88.3g | 91.4g | -3.3% | 45.3 | 49.4 | -8.3% | 2.0 |
| L6D6-N | 81.4g | 80.8g | +0.8% | 49.2 | 49.3 | -0.1% | 4.8 |
| H12D3 | 62.5g | 60.6g | +3.1% | 68.7 | 65.1 | +5.7% | 36.1 |
| VL3D12 | 63.6g | 67.0g | -5.0% | 64.6 | 48.2 | +34.1% | 6.5 |
| L6D12 | 61.0g | 60.4g | +0.9% | 72.5 | 51.8 | +40.0% | 11.2 |

**çµ±è¨ˆ**: FW Mean 2.3%, Max 5.0% | Anth Mean 15.6%, Max 40.0%

### v5.6 â†’ v5.7 ä¿®æ”¹å…§å®¹ï¼šèƒ½é‡å–®ä½å…¬å¼

**éœ€æ±‚**: å°‡æ™‚é–“é–¾å€¼ (6 å°æ™‚) æ”¹ç‚ºèƒ½é‡å–®ä½ [kJ/mÂ²]ï¼Œä½¿å…¬å¼æ›´å…·é€šç”¨æ€§ï¼Œè®“å…¶ä»–ç ”ç©¶è€…å¯ä»¥å¥—ç”¨ä¸åŒçš„UVå¼·åº¦ã€‚

**åŸå…¬å¼ (æ™‚é–“åŸºç¤)**:
```python
intraday_factor = 1 + k Ã— softplus(hours_elapsed - 6, sharpness)^m
```

**æ–°å…¬å¼ (èƒ½é‡åŸºç¤)**:
```python
intraday_factor = 1 + k Ã— softplus((E_elapsed - E_50) / E_scale, sharpness)^m

å…¶ä¸­:
  E_elapsed = I_UVA_config Ã— hours_elapsed Ã— 3.6 [kJ/mÂ²]
  E_50 = 237.6 kJ/mÂ² (â‰ˆ6h @ 11 W/mÂ²)
  E_scale = 39.6 kJ/mÂ² (â‰ˆ1h @ 11 W/mÂ²)
  k = 1.5
  m = 2.0
  sharpness = 3.0
```

**é€šç”¨æ€§èªªæ˜**:
- åƒæ•¸ E_50 å’Œ E_scale éƒ½æ˜¯èƒ½é‡å–®ä½ [kJ/mÂ²]
- é©ç”¨æ–¼ä»»ä½• UVA å¼·åº¦ï¼Œåªéœ€æ ¹æ“šä¸åŒå¯¦é©—æ¢ä»¶èª¿æ•´
- E_50 = 237.6 kJ/mÂ² æ˜¯é€šéç¶²æ ¼æœå°‹æ ¡æº–å¾—åˆ°çš„æœ€ä½³å€¼ï¼ˆæœ€ä½³å€é–“ 5.5-6.0h @ 11 W/mÂ²ï¼‰
- softplus å‡½æ•¸ç¢ºä¿å®Œå…¨é€£çºŒï¼Œç„¡ç¡¬æ€§é–¾å€¼

**é–¾å€¼æ ¡æº–çµæœ**:
| é–¾å€¼ (h @ 11 W/mÂ²) | Mean FW Error | Max FW Error |
|-------------------|---------------|--------------|
| 5.0 h             | 3.2%          | 6.1%         |
| **5.5 h (æœ€ä½³)**  | **2.0%**      | **5.0%**     |
| 6.0 h (æ¡ç”¨)      | 2.3%          | 5.0%         |
| 6.5 h             | 3.3%          | 8.8%         |

### æ ¸å¿ƒæ©Ÿåˆ¶ç¸½çµ

1. **UVA-PAR å³æ™‚å¢ç›Š**: `I_effective = I_base + I_UVA Ã— par_conversion_factor`
2. **LAI è„†å¼±æ€§**: `vulnerability = cap Ã— (LAI_ref/LAI)^n / (cap + (LAI_ref/LAI)^n)`
3. **æ—¥å…§èƒ½é‡éç·šæ€§ (v5.7)**: `intraday_factor = 1 + k Ã— softplus((E - E_50) / E_scale)^m`
4. **Stress æ­£åé¥‹**: `nonlinear_factor = 1 + Î± Ã— Stress / (K + Stress)`
5. **å¤œé–“ç¯€å¾‹æŠ‘åˆ¶**: `circadian_penalty = 2.0`ï¼ˆå¤œé–“ UVA æ™‚ï¼‰
6. **ç¢³ä¾è³´ä¿®å¾©**: `repair_capacity = 0.5 + 0.5 Ã— C_buf / (K + C_buf)`

### ç‰ˆæœ¬æ¼”åŒ–ç´€éŒ„

1. **v5.5**: ä¿®æ­£å¤œé–“ UVA-PAR å…‰åˆè²¢ç»
   - Sun æ¨¡å‹æ–°å¢ `I_override` åƒæ•¸
   - `circadian_disruption_factor: 1.0 â†’ 2.0`

2. **v5.6**: ä¿®å¾©èƒ½åŠ›åƒæ•¸åŒ–
   - å°‡ `repair_capacity = 1.0` ç¡¬ç·¨ç¢¼æ”¹ç‚ºç¢³ä¾è³´å…¬å¼
   - ç”Ÿç‰©å­¸ä¾æ“šï¼šæ¤ç‰©ä¿®å¾© UV æå‚·éœ€è¦èƒ½é‡å’Œç¢³éª¨æ¶

3. **v5.7**: èƒ½é‡å–®ä½å…¬å¼
   - å°‡æ™‚é–“é–¾å€¼ (6h) æ”¹ç‚ºèƒ½é‡å–®ä½ (237.6 kJ/mÂ²)
   - æé«˜æ¨¡å‹é€šç”¨æ€§ï¼Œé©ç”¨æ–¼ä¸åŒ UVA å¼·åº¦
   - ç¶²æ ¼æœå°‹æ ¡æº– E_50 æœ€ä½³å€¼ç‚º 5.5h (217.8 kJ/mÂ²)ï¼Œæ¡ç”¨ 6.0h (237.6 kJ/mÂ²)

4. **æ–‡æª”æ›´æ–°å®Œæˆ**:
   - âœ… æ›´æ–°è«–æ–‡ä¸­çš„èƒ½é‡å…¬å¼èªªæ˜èˆ‡åƒæ•¸è¡¨
   - âœ… æ›´æ–° `generate_paper_figures.py` ä½¿ç”¨èƒ½é‡å…¬å¼ (Fig 15 æ”¹ç‚ºé›™é¢æ¿)
   - âœ… åˆªé™¤èˆŠæ¸¬è©¦è…³æœ¬ (`test_continuous_formula.py`, `test_threshold_sensitivity.py`)

### æ¨¡å‹åƒæ•¸é–¾å€¼ç¸½è¦½

æ‰€æœ‰é–¾å€¼éƒ½å·²**åƒæ•¸åŒ–**ï¼ˆåœ¨ `UVAParams` é¡åˆ¥ä¸­å®šç¾©ï¼‰ï¼š

| æ©Ÿåˆ¶ | åƒæ•¸ | å€¼ | å–®ä½ | èªªæ˜ |
|------|------|-----|------|------|
| æ—¥å…§èƒ½é‡é–¾å€¼ | E_50 | 237.6 | kJ/mÂ² | â‰ˆ6h @ 11 W/mÂ² |
| èƒ½é‡å°ºåº¦ | E_scale | 39.6 | kJ/mÂ² | â‰ˆ1h @ 11 W/mÂ² |
| LAI è„†å¼±æ€§ | LAI_ref_vuln | 7.5 | - | åƒè€ƒ LAI å€¼ |
| èŠ±é’ç´ èª˜å° | stress_threshold_anth | 15.0 | Stress | Stress é–¾å€¼ |
| ç¯€å¾‹æå‚· | circadian_disruption_factor | 2.0 | å€æ•¸ | å¤œé–“ UVA æå‚·åŠ æˆ |
| Stress åŠé£½å’Œ | K_nonlinear | 3.0 | Stress | éç·šæ€§æ”¾å¤§ |
| ç”Ÿé•·æŠ‘åˆ¶ | K_stress | 5.0 | Stress | æŠ‘åˆ¶åŠé£½å’Œ |

### æ•æ„Ÿåº¦åˆ†æçµæœ (2025-12-17)

**åˆ†æç¯„åœ**: 25 å€‹è‡ªå‰µåƒæ•¸ Ã— 4 è™•ç†çµ„
- UVA_Stress: 13 å€‹åƒæ•¸
- Anthocyanin: 7 å€‹åƒæ•¸
- Carbon_Repair: 3 å€‹åƒæ•¸
- LDMC: 2 å€‹åƒæ•¸

**åˆ†ææ–¹æ³•**: å–®åƒæ•¸è®Šç•°æ³• (OAT)ï¼ŒÂ±30% åƒæ•¸è®ŠåŒ–ï¼Œè¨ˆç®—å½ˆæ€§ä¿‚æ•¸ S = (Î”Y/Y) / (Î”X/X)

#### H12D3 è™•ç†çµ„ (é«˜åŠ‘é‡ï¼Œæœ€å…·ä»£è¡¨æ€§)

| æŒ‡æ¨™ | Top 1 | S | Top 2 | S | Top 3 | S |
|------|-------|---|-------|---|-------|---|
| FW | LAI_ref_vuln | -1.28 | E_50 | +0.61 | E_scale | +0.39 |
| Stress | LAI_ref_vuln | +13.2 | E_50 | -3.35 | E_scale | -2.57 |
| Anth | LAI_ref_vuln | +1.60 | k_deg | -0.95 | E_50 | -0.85 |

#### L6D6-N è™•ç†çµ„ (å¤œé–“ç…§å°„)

| æŒ‡æ¨™ | Top 1 | S | Top 2 | S | Top 3 | S |
|------|-------|---|-------|---|-------|---|
| FW | LAI_ref_vuln | -0.95 | circadian_disruption | -0.20 | stress_damage_coeff | -0.20 |
| Stress | LAI_ref_vuln | +19.5 | stress_damage_coeff | +1.56 | circadian_disruption | +1.53 |

#### é—œéµç™¼ç¾

**UVA é€†å¢ƒæ©Ÿåˆ¶**:
1. **LAI_ref_vuln æ˜¯æœ€æ•æ„Ÿåƒæ•¸**ï¼šå° FWã€Stressã€Anth å½±éŸ¿æœ€å¤§
   - å½ˆæ€§ä¿‚æ•¸: FW -0.7~-1.3, Stress +13~23, Anth +1.3~2.0
   - é€™ç¬¦åˆç”Ÿç‰©å­¸ï¼šå¹¼è‹— LAI å°ï¼Œå° UVA æœ€è„†å¼±
   - å»ºè­°ï¼šæ­¤åƒæ•¸éœ€è¦ç²¾ç¢ºæ ¡æº–

2. **E_50 å’Œ E_scale å°é«˜åŠ‘é‡è™•ç†æ•æ„Ÿ**ï¼š
   - åœ¨ H12D3 (12h/day) è™•ç†ä¸­æ•æ„Ÿåº¦é«˜
   - åœ¨ L6D6 (6h/day) è™•ç†ä¸­æ•æ„Ÿåº¦è¼ƒä½
   - èªªæ˜èƒ½é‡é–¾å€¼å…¬å¼åœ¨é«˜åŠ‘é‡æ™‚æ›´é‡è¦

3. **circadian_disruption_factor åªåœ¨å¤œé–“è™•ç†æ•æ„Ÿ**ï¼š
   - L6D6-N: FW -0.20, Stress +1.53
   - L6D6 å’Œ H12D3: æ•æ„Ÿåº¦ 0.00
   - ç¬¦åˆé æœŸï¼šåªæœ‰å¤œé–“ UVA æ‰è§¸ç™¼ç¯€å¾‹æå‚·

**èŠ±é’ç´ æ©Ÿåˆ¶**:
1. **k_deg (é™è§£ç‡)** å°èŠ±é’ç´ æ¿ƒåº¦å½±éŸ¿æœ€å¤§ (S â‰ˆ -1.0)
   - æ‰€æœ‰è™•ç†çµ„å‡ä¸€è‡´
   - é™è§£ç‡æ±ºå®šèŠ±é’ç´ ç©©æ…‹æ¿ƒåº¦

2. **base_anth_rate_light (æ—¥é–“åŸºç¤åˆæˆ)** æ¬¡ä¹‹ (S â‰ˆ +0.8)
   - åœ¨ CK çµ„æœ€é‡è¦ (ç„¡ Stress èª˜å°æ™‚)

3. **V_max_anth (Stressèª˜å°åˆæˆ)** åªåœ¨é«˜åŠ‘é‡è™•ç†æœ‰è¼•å¾®å½±éŸ¿
   - H12D3: S = +0.07
   - L6D6: S â‰ˆ 0

**ç¢³ä¾è³´ä¿®å¾©**:
- base_repair_capacity èˆ‡ stress_repair_coeff æ•æ„Ÿåº¦ç›¸è¿‘
- carbon_repair_bonus å’Œ K_carbon å½±éŸ¿æ¥µå° (ç¢³æ± é€šå¸¸ä¸é™åˆ¶ä¿®å¾©)

**LDMC**:
- ldmc_stress_sensitivity åœ¨é«˜åŠ‘é‡è™•ç†æœ‰ä¸­ç­‰å½±éŸ¿ (FW: -0.3)

**CK å°ç…§çµ„**:
- æ‰€æœ‰ UVA ç›¸é—œåƒæ•¸æ•æ„Ÿåº¦ç‚º 0 (ç¬¦åˆé æœŸ)
- åªæœ‰èŠ±é’ç´ åŸºç¤åˆæˆç‡å’Œé™è§£ç‡æœ‰å½±éŸ¿

#### ç”Ÿæˆåœ–è¡¨

- `paper_figures/FigS3_sensitivity_heatmap.png/pdf` - æ•æ„Ÿåº¦ç†±åŠ›åœ–
- `paper_figures/FigS4_tornado_H12D3.png/pdf` - H12D3 é¾æ²é¢¨åœ–

### ä¸‹ä¸€æ­¥å¾…è¾¦

1. ~~**æ•æ„Ÿåº¦åˆ†æ**: æ¸¬è©¦é—œéµåƒæ•¸çš„æ•æ„Ÿåº¦~~ âœ… å·²å®Œæˆ
2. ~~**æ“´å±•æ•æ„Ÿåº¦åˆ†æ**: åŠ å…¥èŠ±é’ç´ ã€ç¢³ä¿®å¾©ã€LDMC åƒæ•¸~~ âœ… å·²å®Œæˆ
3. **è€ƒæ…®ç§»é™¤ model_config.py ä¸­æœªä½¿ç”¨çš„åƒæ•¸å…ˆé©—** (PARAM_PRIORS, NIGHT_INHIBITION_SCENARIOS)
