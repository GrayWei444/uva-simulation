# v6.1 é‡å¤§ Bug ä¿®å¾©å ±å‘Š

**æ—¥æœŸ**: 2025-12-22
**ç‰ˆæœ¬**: v6.1
**ç‹€æ…‹**: âœ… Critical Bug å·²ä¿®å¾©ï¼ŒL6D6 é æ¸¬å¤§å¹…æ”¹å–„

---

## ğŸ› ç™¼ç¾çš„ Bug

### Bug æè¿°

åœ¨ [simulate_uva_model.py:197-198](simulate_uva_model.py#L197-L200) ä¸­ï¼Œ`day_from_sowing` è¨ˆç®—éŒ¯èª¤ï¼š

**éŒ¯èª¤ä»£ç¢¼ (v6.0)**:
```python
day_from_transplant = t / 86400.0
day_from_sowing = day_from_transplant + p.transplant_day  # BUG!
```

**å•é¡Œ**:
- `t` æ˜¯å¾æ’­ç¨®é–‹å§‹çš„çµ•å°æ™‚é–“ (å› ç‚º `t_start = transplant_day * 86400 = 14 * 86400`)
- æ‰€ä»¥ `t = 15 * 86400` æ™‚æ‡‰è©²æ˜¯ **Day 15 from sowing**
- ä½†éŒ¯èª¤ä»£ç¢¼è¨ˆç®—: `day_from_sowing = 15 + 14 = 29` âŒ

**å½±éŸ¿**:
- L6D6 åœ¨ Day 15 (UVA ç…§å°„é–‹å§‹å‰ 14 å¤©!) å°±è¢«èª¤åˆ¤ç‚ºåœ¨ UVA ç…§å°„çª—å£å…§ (Day 29-35)
- å°è‡´ Stress å¾ Day 15 é–‹å§‹ç´¯ç©ï¼Œè€Œä¸æ˜¯ Day 29
- åˆ° Day 21 æ™‚ï¼ŒStress å·²ç¶“ç´¯ç©åˆ° 123ï¼
- æ¤ç‰©ç”Ÿé•·è¢«åš´é‡æŠ‘åˆ¶ (FW å¾æ‡‰æœ‰çš„ 35g é™è‡³ 13g)

---

## âœ… ä¿®å¾©æ–¹æ¡ˆ

**æ­£ç¢ºä»£ç¢¼ (v6.1)**:
```python
# v6.1 BUG FIX: t æ˜¯å¾æ’­ç¨®é–‹å§‹çš„çµ•å°æ™‚é–“ (t_start = transplant_day * 86400)
# æ‰€ä»¥ day_from_sowing = t / 86400.0 (ç›´æ¥è½‰æ›)
day_from_sowing = t / 86400.0  # æ’­ç¨®å¾Œå¤©æ•¸ (çµ•å°æ™‚é–“)
day_from_transplant = day_from_sowing - p.transplant_day  # ç§»æ¤å¾Œå¤©æ•¸ (ç›¸å°æ™‚é–“)
```

**é‚è¼¯**:
- `t` å·²ç¶“æ˜¯å¾æ’­ç¨®é–‹å§‹çš„çµ•å°æ™‚é–“
- `day_from_sowing` ç›´æ¥é™¤ä»¥ 86400 è½‰æ›
- `day_from_transplant` æ¸›å»ç§»æ¤æ—¥å¾—åˆ°ç›¸å°å¤©æ•¸

---

## ğŸ“Š ä¿®å¾©æ•ˆæœå°æ¯”

### L6D6 ç‹€æ…‹è®ŠåŒ– (Day 14-21, UVA ç…§å°„å‰)

| Day | Stress (v6.0) | Stress (v6.1) | FW (v6.0) | FW (v6.1) | ç‹€æ…‹ |
|-----|---------------|---------------|-----------|-----------|------|
| 14  | 0.00          | 0.00          | 10.00g    | 10.00g    | âœ“ ç›¸åŒ |
| 15  | **30.77**     | 0.00          | 12.86g    | 12.86g    | âœ… Bug ä¿®å¾© |
| 18  | **122.40**    | 0.00          | **10.13g** | 22.02g    | âœ… å·¨å¤§æ”¹å–„ |
| 21  | **123.07**    | 0.00          | **13.00g** | 34.96g    | âœ… å®Œç¾ä¿®å¾© |

**v6.0 å•é¡Œ**: Day 15-21 éŒ¯èª¤ç´¯ç© Stress = 123ï¼Œå°è‡´ç”Ÿé•·åš´é‡æŠ‘åˆ¶
**v6.1 ä¿®å¾©**: Day 15-21 Stress = 0 (æ­£ç¢º)ï¼Œç”Ÿé•·æ­£å¸¸

---

### æœ€çµ‚é æ¸¬çµæœå°æ¯”

| è™•ç†çµ„ | v6.0 FW | v6.1 FW | ç›®æ¨™ FW | v6.0 èª¤å·® | v6.1 èª¤å·® | æ”¹å–„ |
|--------|---------|---------|---------|-----------|-----------|------|
| **CK** | 87.8g   | 87.8g   | 87.0g   | +1.0%     | +1.0%     | 0.0% âœ“ |
| **L6D6** | **69.2g** | **89.2g** | 91.4g   | **-24.3%** | **-2.5%** | **+21.8%** âœ… |
| **L6D6-N** | 73.4g   | 87.1g   | 80.8g   | -9.2%     | +7.8%     | +1.4% âœ“ |
| **H12D3** | 72.0g   | 90.1g   | 60.6g   | +18.9%    | +48.7%    | -29.8% âŒ |
| **VL3D12** | 74.7g   | 78.8g   | 67.0g   | +11.5%    | +17.6%    | -6.1% âŒ |
| **L6D12** | 73.2g   | 75.1g   | 60.4g   | +21.1%    | +24.3%    | -3.2% âŒ |

**çµ±è¨ˆæ‘˜è¦**:
- **L6D6**: èª¤å·®å¾ -24.3% â†’ -2.5% (**æ”¹å–„ 21.8%**) âœ…
- **CK**: ç¶­æŒ +1.0% (ä¸å—å½±éŸ¿) âœ“
- **L6D6-N**: èª¤å·®å¾ -9.2% â†’ +7.8% (æ”¹å–„ 1.4%) âœ“

---

## ğŸ” ç‚ºä»€éº¼å…¶ä»–çµ„è®Šå·®äº†ï¼Ÿ

**è§€å¯Ÿ**:
- H12D3: +18.9% â†’ +48.7% (é«˜ä¼°æ›´åš´é‡)
- VL3D12: +11.5% â†’ +17.6% (é«˜ä¼°æ›´åš´é‡)
- L6D12: +21.1% â†’ +24.3% (é«˜ä¼°æ›´åš´é‡)

**åŸå› åˆ†æ**:

### v6.0 çš„ Bug å‰µé€ äº†"å‡å¹³è¡¡"

åœ¨ v6.0 ä¸­ï¼š
- **æ‰€æœ‰è™•ç†çµ„** (åŒ…æ‹¬ CK!) éƒ½å—åˆ° Bug å½±éŸ¿
- ä½†å½±éŸ¿ç¨‹åº¦ä¸åŒ:
  - CK: Day 15-21 è¢«èª¤åˆ¤ç‚º Day 29-35ï¼Œä½† `uva_on = False`ï¼Œæ‰€ä»¥ I_UVA = 0
  - L6D6: Day 15-21 è¢«èª¤åˆ¤ç‚º Day 29-35ï¼Œä¸” `uva_on = True`ï¼Œæ‰€ä»¥éŒ¯èª¤ç´¯ç© Stress
  - H12D3: Day 18-24 è¢«èª¤åˆ¤ç‚º Day 32-38ï¼Œéƒ¨åˆ†è½åœ¨ UVA çª—å£å¤–

### v6.1 ä¿®å¾©å¾Œçš„çœŸå¯¦æƒ…æ³

Bug ä¿®å¾©å¾Œï¼š
- L6D6 çš„ Stress ç´¯ç©å¤§å¹…æ¸›å°‘ â†’ ç”Ÿé•·ä¿ƒé€²æ•ˆæ‡‰é¡¯ç¾ âœ…
- ä½†é«˜åŠ‘é‡çµ„ (H12D3, L6D12) çš„ Stress ç´¯ç©ä»ä¸è¶³ â†’ é æ¸¬éåº¦é«˜ä¼° âŒ

**çµè«–**: v6.0 çš„åƒæ•¸æ˜¯åœ¨ Bug å­˜åœ¨çš„æƒ…æ³ä¸‹æ ¡æº–çš„ï¼Œä¿®å¾© Bug å¾Œéœ€è¦**é‡æ–°æ ¡æº– Stress åƒæ•¸**

---

## ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè­°

### å„ªå…ˆç´š 1: é‡æ–°æ ¡æº– Stress åƒæ•¸

**ç›®æ¨™**: å¹³è¡¡æ‰€æœ‰è™•ç†çµ„çš„é æ¸¬

**ç­–ç•¥**:
1. **ä¿æŒ L6D6 çš„å„ªç§€è¡¨ç¾** (èª¤å·® -2.5%)
2. **é™ä½é«˜åŠ‘é‡çµ„çš„é«˜ä¼°** (H12D3, VL3D12, L6D12)

**å¯èª¿æ•´åƒæ•¸**:
```python
# æ–¹æ¡ˆ A: æé«˜æå‚·ä¿‚æ•¸ (è®“é«˜åŠ‘é‡çµ„ç´¯ç©æ›´å¤š Stress)
stress_damage_coeff: 0.8e-6 â†’ 1.2e-6  # æé«˜ 50%

# æ–¹æ¡ˆ B: å¢å¼·éç·šæ€§ç´¯ç© (é«˜åŠ‘é‡ç´¯ç©åŠ é€Ÿ)
stress_nonlinear_coeff: 2.0 â†’ 3.0  # æé«˜ 50%

# æ–¹æ¡ˆ C: é™ä½ E_50 (è®“é•·æ™‚ç…§å°„è§¸ç™¼éç·šæ€§)
E_50: 800.0 â†’ 600.0  # é™ä½ 25%
```

### å„ªå…ˆç´š 2: ä¿®å¾©èŠ±é’ç´ é æ¸¬

L6D6 èŠ±é’ç´ èª¤å·®å¾ +2.6% â†’ -17.8% (æƒ¡åŒ–)

**å¯èƒ½åŸå› **:
- v6.0 ä¸­ L6D6 éŒ¯èª¤ç´¯ç© Stress â†’ èŠ±é’ç´ åˆæˆå¢åŠ  â†’ èª¤æ‰“èª¤æ’æ¥è¿‘ç›®æ¨™
- v6.1 ä¿®å¾©å¾Œ Stress æ­£å¸¸ â†’ èŠ±é’ç´ åˆæˆæ¸›å°‘

**è§£æ±ºæ–¹æ¡ˆ**:
- æé«˜åŸºç¤åˆæˆç‡: `base_anth_rate_light: 4.0e-10 â†’ 6.0e-10`
- æˆ–é™ä½ K_stress_anth (è®“ä½ Stress ä¹Ÿèƒ½èª˜å°åˆæˆ)

---

## âœ… v6.1 æˆå°±

1. **æ‰¾åˆ°ä¸¦ä¿®å¾©è‡´å‘½ Bug** â­â­â­
   - `day_from_sowing` è¨ˆç®—éŒ¯èª¤
   - å°è‡´ UVA ç…§å°„æ™‚é–“çª—å£åˆ¤æ–·éŒ¯èª¤
   - å½±éŸ¿æ‰€æœ‰è™•ç†çµ„çš„ Stress ç´¯ç©

2. **L6D6 é æ¸¬å¤§å¹…æ”¹å–„** â­â­â­
   - é®®é‡èª¤å·®: -24.3% â†’ -2.5% (æ”¹å–„ 21.8%)
   - çµ‚æ–¼æ¥è¿‘å¯¦ç¾ä¿ƒé€²æ•ˆæ‡‰ï¼

3. **æ­ç¤ºåƒæ•¸æ ¡æº–å•é¡Œ**
   - v6.0 çš„åƒæ•¸æ˜¯åœ¨ Bug å­˜åœ¨ä¸‹æ ¡æº–çš„
   - éœ€è¦é‡æ–°æ ¡æº–ä»¥å¹³è¡¡æ‰€æœ‰è™•ç†çµ„

---

## ğŸ“ ä¿®æ”¹å…§å®¹

### [simulate_uva_model.py:197-200](simulate_uva_model.py#L197-L200)

```python
# v6.0 (éŒ¯èª¤)
day_from_transplant = t / 86400.0
day_from_sowing = day_from_transplant + p.transplant_day

# v6.1 (æ­£ç¢º)
day_from_sowing = t / 86400.0  # æ’­ç¨®å¾Œå¤©æ•¸ (çµ•å°æ™‚é–“)
day_from_transplant = day_from_sowing - p.transplant_day  # ç§»æ¤å¾Œå¤©æ•¸ (ç›¸å°æ™‚é–“)
```

---

## ğŸ¯ çµè«–

**v6.1 æ˜¯ä¸€å€‹é‡å¤§çªç ´**ï¼š

âœ… **å„ªé»**:
- ä¿®å¾©äº†è‡´å‘½çš„æ™‚é–“è¨ˆç®— Bug
- L6D6 é æ¸¬èª¤å·®é™è‡³ -2.5% (å„ªç§€!)
- è­‰æ˜ UVA ä¿ƒé€²æ•ˆæ‡‰å¯ä»¥å¯¦ç¾

âš ï¸ **å¾…æ”¹é€²**:
- é«˜åŠ‘é‡çµ„è¢«é«˜ä¼° (éœ€é‡æ–°æ ¡æº–åƒæ•¸)
- èŠ±é’ç´ é æ¸¬éœ€è¦èª¿æ•´

**å»ºè­°**: åœ¨ v6.1 çš„åŸºç¤ä¸Šé‡æ–°æ ¡æº– Stress åƒæ•¸ï¼Œç›®æ¨™æ˜¯æ‰€æœ‰è™•ç†çµ„èª¤å·® < 10%

**é€™å€‹ Bug ä¿®å¾©ç‚ºæ¨¡å‹æ ¡æº–æŒ‡æ˜äº†æ­£ç¢ºçš„æ–¹å‘ï¼** ğŸ‰
