# v6.0 Debug Log

**日期**: 2025-12-22
**目標**: 移除 par_conversion_factor 放大效應 + 加入花青素碳成本

---

## 重大發現

### 1. Sun 原始模型可以完美解釋 UVA 效應 ✅

**測試結果**:
```
CK  (57 W/m²):  86.7g (實驗 87.0g, 誤差 -0.4%)
L6D6 (79 W/m²):  90.6g (實驗 91.4g, 誤差 -0.9%)

UVA 導致鮮重增加: +4.0g (+4.6%)
實驗觀察到增加: +4.4g (+5.1%)
```

**結論**: `par_conversion_factor = 1.0` 是正確的！22 W/m² 額外輻射本身就足以解釋鮮重增加。

### 2. UVA 模型預測異常 ❌

**問題**:
```
Sun 模型預測 L6D6: 90.6g
UVA 模型預測 L6D6: 55.2g  (-39.1%)
```

即使 Stress ≈ 0，花青素碳成本 = 0，鮮重仍然嚴重偏低。

### 3. 碳緩衝池動態異常 ❌

**對比 (Day 30, 12:00, 相同狀態)**:
```
Sun 模型 dC_buf/dt = +6.69e-10 kg C/m²/s  (碳增加)
UVA 模型 dC_buf/dt = -7.21e-08 kg C/m²/s  (碳減少)
差異: -10880%！
```

**分析**:
- Sun 模型調用本身沒問題 (測試確認)
- 問題出在 UVA 模型對 `dCbuf_dt` 的後續處理
- 當前花青素碳成本 = 0，修復碳成本極小
- **根本原因尚未找到**

### 4. 花青素基礎合成率過高 ⚠️

**計算**:
```
base_anth_rate_light = 4.0e-10 kg/m²/s
k_deg = 2.6e-6 /s
穩態濃度 = 961.5 ppm

實驗 CK 花青素 = 43.3 ppm
穩態值是實驗值的 22.2 倍！
```

這解釋了為什麼花青素預測值爆炸 (+1800%)。

---

## 參數重構完成 ✅

創建了統一的參數配置文件 [params_config.py](params_config.py)，包含：
- Sun 基礎模型參數
- UVA-PAR 轉換參數
- Stress 損傷與修復參數
- 碳修復參數
- 花青素參數
- LDMC 參數

---

## 待解決問題

### 核心 Bug: UVA 模型的 dC_buf/dt 異常

**已排除的原因**:
- ❌ 花青素碳成本 (已設為 0，仍有問題)
- ❌ 修復碳成本 (Stress ≈ 0，幾乎無消耗)
- ❌ Sun 模型調用 (測試確認正確)

**可能的原因**:
1. `dCbuf_dt` 在 Sun 模型返回後，被某處意外修改
2. Sun 模型內部的 `dCbuf_dt` 計算邏輯在某些條件下異常
3. 狀態變量的相互作用導致負反饋循環

**Debug 策略**:
1. 在 `uva_sun_derivatives` 中加入詳細的 debug 輸出
2. 逐步追蹤 `dCbuf_dt` 的變化
3. 對比 Sun 模型在完全相同輸入下的輸出
4. 檢查是否有隱藏的狀態耦合

---

## 建議的下一步

1. **優先修復 dC_buf/dt Bug**
   - 這是導致鮮重預測偏低 40% 的根本原因
   - 需要深入 debug `uva_sun_derivatives` 函數

2. **重新校準花青素參數**
   - 降低 `base_anth_rate_light` (目前過高 22倍)
   - 建議值: ~1.8e-11 kg/m²/s (原值的 4.5%)

3. **花青素碳成本機制**
   - Gemini 的建議在生理學上是正確的
   - 但實作時需要極小的係數 (< 0.001)
   - 或暫時保持為 0，等主要 bug 修復後再啟用

---

## 正確的配置 (已確認)

```python
c_alpha = 0.57                # 使 CK ≈ 87.0g
par_conversion_factor = 1.0   # UVA 22 W/m² 直接加入，無需放大
```

**v6.0 的核心理念是正確的**，只是實作上有 bug 需要修復。
