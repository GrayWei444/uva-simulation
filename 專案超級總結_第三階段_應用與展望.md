# 萵苣UVA模型 - 專案總結與規劃 (第三階段)

## 【第三階段: 應用與未來展望】

**接續**: 第二階段(核心技術與完整程式碼)
**更新日期**: 2025年12月17日
**版本**: v5.7 (能量單位公式)
**狀態**: ✅ 模型校準完成 (Mean FW 誤差 2.3%, Max 5.0%)

---

## 📑 第三階段目錄

### 本階段內容
14. [結果可視化：模板與指南](#14-結果可視化模板與指南)
15. [商業應用框架](#15-商業應用框架)
16. [模型的擴展與推廣](#16-模型的擴展與推廣)
17. [潛在問題與解決策略 (Troubleshooting)](#17-潛在問題與解決策略-troubleshooting)
18. [未來研究方向](#18-未來研究方向)
19. [附錄：參數與數據結構](#19-附錄參數與數據結構)

---

# 14. 結果可視化：模板與指南

一旦我們的模型開發完成，清晰的結果可視化將是理解模擬結果、展示研究成果的關鍵。本章節提供了一些Python Matplotlib腳本模板，用於生成核心的分析圖表。

### 14.1 圖表模板 A：生長曲線動態

**用途**: 展示在不同UVA處理下，萵苣的鮮重、乾重、葉面積指數（LAI）隨時間的變化。
**重要性**: 直觀判斷不同策略對生長過程的影響。

```python
# TEMPLATE for plotting growth dynamics
import matplotlib.pyplot as plt

def plot_growth_curves(results_dict):
    """
    results_dict: A dictionary where keys are treatment names (e.g., 'CK', 'UVA_optimal')
                  and values are the simulation result dataframes.
    """
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5), dpi=150)

    # Plot Fresh Weight
    for name, result in results_dict.items():
        ax1.plot(result['time'], result['fresh_weight_g'], label=name)
    ax1.set_xlabel('時間 (天)')
    ax1.set_ylabel('預計鮮重 (g/plant)')
    ax1.set_title('不同處理下的鮮重生長曲線')
    ax1.legend()
    ax1.grid(True, alpha=0.3)

    # Plot Anthocyanin Content
    for name, result in results_dict.items():
        ax2.plot(result['time'], result['anthocyanin_ppm'], label=name)
    ax2.set_xlabel('時間 (天)')
    ax2.set_ylabel('預計花青素含量 (ppm)')
    ax2.set_title('不同處理下的花青素積累曲線')
    ax2.legend()
    ax2.grid(True, alpha=0.3)

    plt.tight_layout()
    plt.savefig('growth_and_anthocyanin_dynamics.png')
    plt.show()

# --- Example Usage ---
# ck_results = run_simulation('CK')
# uva_results = run_simulation('UVA_optimal')
# plot_growth_curves({'CK': ck_results, 'UVA_Optimal': uva_results})
```

### 14.2 圖表模板 B：劑量-反應曲線

**用途**: 分析UVA的累積劑量與最終產量、品質指標之間的關係。
**重要性**: 尋找最佳劑量窗口和識別報酬遞減點。

```python
# TEMPLATE for plotting dose-response curves
import numpy as np

def plot_dose_response(simulation_summary):
    """
    simulation_summary: A dataframe with columns ['dose', 'final_fw', 'final_anth']
                        from running simulations with various UVA doses.
    """
    doses = simulation_summary['dose']
    final_fw = simulation_summary['final_fw']
    final_anth = simulation_summary['final_anth']

    fig, ax1 = plt.subplots(figsize=(8, 5), dpi=150)

    # Plot Fresh Weight response
    color = 'tab:green'
    ax1.set_xlabel('UVA 累積劑量 (J/m²)')
    ax1.set_ylabel('最終鮮重 (g)', color=color)
    ax1.plot(doses, final_fw, 'o-', color=color, label='鮮重')
    ax1.tick_params(axis='y', labelcolor=color)
    ax1.grid(True, alpha=0.3)

    # Create a second y-axis for Anthocyanin
    ax2 = ax1.twinx()
    color = 'tab:purple'
    ax2.set_ylabel('最終花青素 (ppm)', color=color)
    ax2.plot(doses, final_anth, 's--', color=color, label='花青素')
    ax2.tick_params(axis='y', labelcolor=color)

    fig.tight_layout()
    plt.title('UVA劑量對產量與品質的反應曲線')
    plt.savefig('dose_response_curves.png')
    plt.show()

# --- Example Usage ---
# summary = run_multiple_doses()
# plot_dose_response(summary)
```

---

# 15. 商業應用框架

本模型的主要目標是為商業化生產提供決策支持。在模型開發完成並找到最佳UVA參數後，可採用以下框架進行商業可行性評估。

### 15.1 步驟一：成本估算

1.  **初始投資 (CAPEX)**:
    -   **UVA LED 燈具**: 根據所需強度和面積計算總成本。
    -   **控制系統**: 定時器、調光器、感測器等。
    -   **安裝與校準**: 人工費用和儀器（UVA光譜儀）費用。

2.  **運營成本 (OPEX)** (每生產週期):
    -   **電力消耗**: `UVA功率 × 每日時長 × 處理天數 × 電費單價`。
    -   **維護成本**: 設備折舊與維護費用。
    -   **人工成本**: 監測與操作所需的人工時間。

### 15.2 步驟二：收益預測

1.  **產量變化收益**:
    -   使用模型預測在最佳UVA方案下，相對於CK組的**鮮重變化百分比 (ΔFW%)**。
    -   `額外產量收益 = (基礎產量 × ΔFW%) × 售價`。

2.  **品質溢價收益**:
    -   使用模型預測**花青素含量 (Anth_ppm)**。
    -   根據市場調研，為達到特定花青素水平的產品設定一個**品質溢價百分比 (Premium%)**。
    -   `品質溢價收益 = (總產量 × 售價) × Premium%`。

3.  **總收益**: `總額外收益 = 產量變化收益 + 品質溢價收益`。

### 15.3 步驟三：投資回報分析 (ROI)

-   **每週期淨收益**: `總額外收益 - 運營成本 (OPEX)`。
-   **年淨收益**: `每週期淨收益 × (365 / 週期天數)`。
-   **投資回報期 (Payback Period)**: `初始投資 (CAPEX) / 年淨收益`。

這個框架將幫助生產者判斷引入UVA技術在經濟上是否可行，並可以通過調整模型參數（如尋找能耗更低的方案）來優化ROI。

---

# 16. 模型的擴展與推廣

本研究建立的建模框架具有良好的擴展性，可以應用於更廣泛的場景。

### 16.1 推廣至其他萵苣品種

不同品種的紅萵苣對UVA的敏感度和反應可能不同。為新品種尋找最佳方案的流程如下：

1.  **實驗數據採集 (最小化設計)**:
    -   種植新品種，並設置至少3-4個UVA處理組（例如：CK, 低劑量, 中劑量, 高劑量）。
    -   測量最終的鮮重和花青素含量。

2.  **模型參數校準**:
    -   保持Sun (2025)的基礎生長參數不變。
    -   僅重新擬合UVA效應模組的幾個關鍵參數（如光合促進效率、花青素合成速率等），使其能夠匹配新的實驗數據。

3.  **模型優化**:
    -   使用校準後的新模型，運行模擬以尋找該特定品種的最佳UVA方案。

這個流程將實驗試錯的成本降至最低，用少量實驗數據結合模型，高效地為任何新品種量身定制優化方案。

### 16.2 推廣至其他作物

本模型的**碳競爭**核心理念可以推廣到其他希望通過逆境脅迫提升品質的作物（如番茄的茄紅素、草莓的抗氧化物等）。

-   **基礎模型替換**: 需要將Sun (2025)的萵苣模型替換為目標作物的成熟生長模型（如番茄的`TOMGRO`模型）。
-   **脅迫模組接入**: 將我們的UVA碳競爭模組進行修改，接入到新模型的碳水化合物分配節點上。
-   **參數重新校準**: 針對新作物和新的脅迫類型（如鹽脅迫、乾旱脅迫等）進行參數的重新校準。

---

# 17. 潛在問題與解決策略 (Troubleshooting)

在模型開發與應用過程中，可能會遇到以下問題：

### 17.1 模型預測與現實不符

-   **問題**: CK組校準後，UVA組的預測誤差仍然很大。
-   **可能原因**:
    1.  UVA模型的數學形式未能準確捕捉真實生理機制。
    2.  UVA處理影響了基礎生長模型中的某些「固定」參數（如SLA、根冠比等）。
    3.  實驗數據存在誤差或未考慮的環境變量。
-   **解決策略**:
    1.  **重新審視模型結構**: 嘗試不同的函數形式來描述UVA的促進和消耗效應。
    2.  **擴大校準範圍**: 允許UVA影響部分基礎參數，增加模型的自由度，但需注意過擬合風險。
    3.  **補充實驗**: 設計新的實驗來驗證模型的特定假設。

### 17.2 模擬結果顯示「雙贏」不可行

-   **問題**: 無論如何調參，模型都顯示任何劑量的UVA都會導致鮮重下降。
-   **可能原因**:
    1.  在我們的系統中，UVA對光合的促進效應確實不存在或非常微弱。
    2.  花青素合成的碳消耗遠高於預期。
-   **解決策略**:
    1.  **接受現實**: 如果模型準確，這本身就是一個重要的科學發現，意味著「生長-防禦權衡」在UVA脅迫下不可避免。
    2.  **重新定義優化目標**: 將目標從「雙贏」轉變為「在可接受的產量損失範圍內（如5%），最大化花青素含量」，尋找商業上最有利的權衡點。

---

# 18. 未來研究方向

本模型為未來的研究奠定了堅實的基礎。

### 18.1 當前成果總結 (v5.7)

**✅ 模型校準已完成！** 所有 6 個處理組的鮮重誤差均 < 5%：

| 指標 | Mean | Max |
|------|------|-----|
| FW 誤差 | 2.3% | 5.0% |
| Anth 誤差 | 15.6% | 40.0% |

### 18.2 敏感度分析結果 ✅ 已完成

**分析範圍**: 25 個自創參數 × 4 處理組
- UVA_Stress: 13 個參數
- Anthocyanin: 7 個參數
- Carbon_Repair: 3 個參數
- LDMC: 2 個參數

**分析方法**: 單參數變異法 (OAT)，±30% 參數變化，計算彈性係數 S = (ΔY/Y) / (ΔX/X)

#### 18.2.1 關鍵發現

**UVA 逆境機制**:

| 參數 | 類別 | FW 敏感度 | Stress 敏感度 | 生物學意義 |
|------|------|-----------|---------------|------------|
| LAI_ref_vuln | 脆弱性 | -0.7 ~ -1.3 | +13 ~ +23 | **最敏感參數**：幼苗 LAI 小，對 UVA 最脆弱 |
| E_50 | 能量閾值 | +0.61 | -3.35 | 能量閾值越高，Stress 越低 |
| E_scale | 能量尺度 | +0.39 | -2.57 | 能量尺度越大，過渡越平滑 |
| circadian_disruption | 節律 | -0.20* | +1.53* | *只在夜間處理 (L6D6-N) 有效 |

**花青素機制**:

| 參數 | 類別 | Anth 敏感度 | 生物學意義 |
|------|------|-------------|------------|
| k_deg | 降解 | -0.95 ~ -1.0 | 降解率決定穩態濃度 |
| base_anth_rate_light | 基礎合成 | +0.75 ~ +0.81 | 日間基礎合成 |
| V_max_anth | Stress誘導 | +0.07 | 只在高劑量處理有輕微影響 |

**碳依賴修復與 LDMC**:

| 參數 | 類別 | FW 敏感度 | 說明 |
|------|------|-----------|------|
| base_repair_capacity | 修復 | +0.10 | 與 stress_repair_coeff 敏感度相近 |
| ldmc_stress_sensitivity | LDMC | -0.30* | *只在高劑量處理 (H12D3) 有效 |

#### 18.2.2 模型穩定性評估

1. **LAI_ref_vuln 是最敏感參數**：
   - 對 FW、Stress、Anth 三個輸出變量影響最大
   - 建議：此參數需要精確校準，可考慮額外實驗驗證
   - 生物學解釋：幼苗葉片少，每單位葉面積承受的 UVA 輻射量大

2. **能量閾值參數 (E_50, E_scale) 在高劑量處理敏感**：
   - H12D3 (12h/day): E_50 敏感度 = +0.61 (FW), -3.35 (Stress)
   - L6D6 (6h/day): E_50 敏感度 = +0.09 (FW), -1.37 (Stress)
   - 說明能量累積非線性機制在高劑量時更重要

3. **circadian_disruption_factor 驗證夜間機制**：
   - L6D6-N (夜間): 敏感度 = -0.20 (FW), +1.53 (Stress)
   - L6D6, H12D3 (日間): 敏感度 = 0.00
   - 符合生理預期：只有夜間 UVA 才觸發節律損傷

4. **CK 對照組驗證**：
   - 所有 UVA 相關參數敏感度為 0
   - 只有花青素基礎合成率和降解率有影響
   - 確認模型在無 UVA 條件下行為正確

#### 18.2.3 敏感度分析圖表

- `paper_figures/FigS3_sensitivity_heatmap.png/pdf` - 敏感度熱力圖
- `paper_figures/FigS4_tornado_H12D3.png/pdf` - H12D3 龍捲風圖

### 18.3 近期目標

1. ~~**敏感度分析**: 測試關鍵參數的敏感度，評估模型穩定性~~ ✅ 已完成
2. **花青素校準優化**: Anth 誤差較大（VL3D12: +34%, L6D12: +40%），可考慮進一步優化
3. ~~**模型文件整理**: 準備論文用圖表和說明~~ ✅ 已完成

### 18.4 中期目標

-   **模型验证**: 使用校準好的模型，對新的實驗數據進行預測，驗證泛化能力
-   **动态光照策略探索**: 利用模型進行虛擬實驗，探索更複雜的動態 UVA 策略

### 18.5 長期願景 (3-5年)

-   **數字孿生 (Digital Twin)**: 將模型與實時感測器數據結合，創建能動態調整 UVA 策略的系統
-   **基因型 x 環境 x 管理 (GxExM)**: 將不同品種的遺傳參數納入模型，開發品種特異性的最佳管理策略推薦系統

---

# 19. 附錄：參數與數據結構

### 19.1 UVA模型完整參數表 (v5.7)

#### 19.1.1 UVA 逆境機制參數

| 參數符號 | 描述 | 校準值 | 單位 | 敏感度等級 |
| :--- | :--- | :--- | :--- | :--- |
| `E_50` | 日內能量半飽和閾值 | 237.6 | kJ/m² | **高** |
| `E_scale` | 能量尺度 | 39.6 | kJ/m² | **高** |
| `stress_damage_coeff` | 損傷係數 | 3.5e-6 | 1/(W/m²·s) | 中 |
| `stress_repair_coeff` | 修復係數 | 1.0e-5 | 1/s | 中 |
| `LAI_ref_vuln` | LAI 脆弱性參考值 | 7.5 | - | **極高** |
| `n_vuln` | 脆弱性指數 | 7 | - | 中 |
| `k_intraday` | 日內非線性係數 | 1.5 | - | 低 |
| `m_intraday` | 日內指數 | 2.0 | - | 低 |
| `sharpness_intraday` | softplus 銳度 | 3.0 | - | 低 |
| `stress_nonlinear_coeff` | Stress 非線性係數 | 1.5 | - | 低 |
| `K_nonlinear` | Stress 半飽和常數 | 3.0 | Stress | 低 |
| `circadian_disruption_factor` | 節律損傷因子 | 2.0 | 倍數 | 中* |
| `stress_photosynthesis_inhibition` | 光合抑制係數 | 0.70 | - | 低 |
| `K_stress` | 抑制半飽和常數 | 5.0 | Stress | 低 |
| `par_conversion_factor` | UVA-PAR 轉換係數 | 3.0 | - | 低 |

*只在夜間處理有效

#### 19.1.2 花青素機制參數

| 參數符號 | 描述 | 校準值 | 單位 | 敏感度等級 |
| :--- | :--- | :--- | :--- | :--- |
| `base_anth_rate_light` | 日間基礎合成率 | 4.11e-10 | kg/m²/s | **高** |
| `base_anth_rate_dark` | 夜間基礎合成率 | 2.05e-10 | kg/m²/s | 中 |
| `V_max_anth` | 最大 Stress 誘導合成率 | 2.5e-10 | kg/m²/s | 低 |
| `K_m_anth` | 半飽和 Stress 值 | 30.0 | Stress | 低 |
| `stress_threshold_anth` | Stress 閾值 | 15.0 | Stress | 低 |
| `anth_threshold_sharpness` | 閾值銳度 | 0.5 | - | 低 |
| `k_deg` | 降解率 | 2.5e-6 | 1/s | **高** |

#### 19.1.3 碳依賴修復參數

| 參數符號 | 描述 | 校準值 | 單位 | 敏感度等級 |
| :--- | :--- | :--- | :--- | :--- |
| `base_repair_capacity` | 基礎修復能力 | 0.5 | - | 中 |
| `carbon_repair_bonus` | 碳池加成 | 0.5 | - | 低 |
| `K_carbon` | 碳池半飽和常數 | 0.001 | kg C/m² | 低 |

#### 19.1.4 LDMC 參數

| 參數符號 | 描述 | 校準值 | 單位 | 敏感度等級 |
| :--- | :--- | :--- | :--- | :--- |
| `dw_fw_ratio_base` | 基礎 DW:FW 比例 | 0.05 | - | - |
| `ldmc_stress_sensitivity` | LDMC 對 Stress 敏感度 | 1.0 | - | 中* |
| `K_ldmc` | LDMC 半飽和 Stress 值 | 50.0 | Stress | 低 |
| `dw_fw_ratio_max` | 最大 DW:FW 比例 | 0.12 | - | - |

*只在高劑量處理有效

#### 19.1.5 敏感度等級說明

| 等級 | 彈性係數 |S| 範圍 | 校準建議 |
| :--- | :--- | :--- |
| **極高** | > 1.0 | 需要精確校準，可考慮額外實驗驗證 |
| **高** | 0.5 ~ 1.0 | 重要參數，需仔細校準 |
| 中 | 0.1 ~ 0.5 | 正常敏感度，標準校準即可 |
| 低 | < 0.1 | 敏感度低，可使用文獻值或合理估計 |

### 19.2 模擬輸出數據結構

建議將每次模擬的結果保存為統一格式的數據文件（如CSV或Parquet），便於後續分析和可視化。

**建議列名**:
`time`, `doy`, `hour`, `X_sdw`, `C_buf`, `LAI`, `fresh_weight_g`, `anthocyanin_g_m2`, `anthocyanin_ppm`, `pg_total`, `r_total`, `g_total`, `anth_consumption`
